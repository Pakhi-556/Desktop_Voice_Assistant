<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>
<body>
    <div class="navbar"><h2>Zira.. </h2>
        <button id="loginBtn">Login</button>
    </div>

    <div id="micContainer" style="display: none;">
        <div class="mic">
            <i class="mic-icon"></i>
            <div class="mic-shadow"></div>
          </div>
    </div>

    <video autoplay muted loop id="video-background">
        <source src="{{ url_for('static', filename='backvedio.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    

    <div class="container">
        <h1 class="glow">Voice Assistant</h1>
        <p>Click the button and speak your command:</p>
        <button href="#" id="startBtn">Start Listening</button>
        <div id="output"></div>
        <div id="response" style="display: none;"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            const recognition = new webkitSpeechRecognition() || new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            const startListening = () => {
                $('#output').text('Listening...');
                recognition.start();
            };

            $('#startBtn').click(async function() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    stream.getTracks().forEach(track => track.stop());
                    startListening();
                    $('.container').hide();
                    $('#micContainer').show()
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('Error accessing microphone. Please allow microphone access to use voice recognition.');
                }
            });

             // Event listener for Alt + Z key press
             $(document).keydown(function(e) {
                if (e.key === 'z') {
                    $('#startBtn').click();
                }
            });
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.trim();
                $('#output').text('Recognized Command: ' + transcript);

                $.ajax({
                    url: '/get-information',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ query: transcript }),
                    success: function(response) {
                        console.log(response);

                       if(response.response_text!=""){
                        // Display the response text on the page
                        $('#response').html('<div class="response-container">'+response.response_text+'</div>');
                        $('#response').show();
                       }else{
                        $('#response').hide();
                       }
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                    }
                });
            };
            
            recognition.onend = function() {
                // Hide mic animation container and show main content container
                $('#micContainer').hide();
                $('.container').show();
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                alert('Speech recognition error. Please try again or allow microphone access.');
            };
            
            $('#loginBtn').click(function() {
                // Redirect to the login page
                window.location.href = '/login';
            });

            // Slowing down the background video playback
            const video = document.getElementById('video-background');
            video.playbackRate = 0.4; // Adjust this value as needed
        });
    </script>
</body>
</html>
